datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Scan {
  id          String      @id @default(cuid())
  keyword     String
  createdAt   DateTime    @default(now())
  status      String      @default("PENDING") // PENDING, RUNNING, COMPLETED, FAILED
  centerLat   Float
  centerLng   Float
  radius      Float
  gridSize    Int         @default(3) // e.g., 3x3, 5x5
  shape       String      @default("SQUARE") // SQUARE, CIRCLE, ZIP
  customPoints String?     // Optional JSON string of manual coordinates
  frequency   String      @default("ONCE") // ONCE, DAILY, WEEKLY
  nextRun     DateTime?
  businessName String?     // Name of business to track ranking for (optional)
  results     Result[]
}

model Result {
  id           String   @id @default(cuid())
  scanId       String
  scan         Scan     @relation(fields: [scanId], references: [id])
  lat          Float
  lng          Float
  rank         Int?     // Rank of the target business (null if not found)
  targetName   String?  // Target business name to track
  topResults   String   // List of top 20 businesses found at this point (JSON string)
  capturedAt   DateTime @default(now())
}

model Proxy {
  id           String   @id @default(cuid())
  host         String
  port         Int
  username     String?
  password     String?
  type         String   @default("RESIDENTIAL") // RESIDENTIAL, DATACENTER
  enabled      Boolean  @default(true)
  status       String   @default("UNTESTED") // UNTESTED, ACTIVE, DEAD
  lastTestedAt DateTime?
  createdAt    DateTime @default(now())

  @@unique([host, port])
}

model Alert {
  id        String   @id @default(cuid())
  type      String   // RANK_UP, RANK_DOWN, SCAN_ERROR
  message   String
  scanId    String
  createdAt DateTime @default(now())
  read      Boolean  @default(false)
}

model GlobalSetting {
  id    String @id @default(cuid())
  key   String @unique
  value String
}

model SystemLog {
  id        String   @id @default(cuid())
  level     String   @default("INFO") // INFO, WARN, ERROR, DEBUG
  message   String
  source    String?  // e.g., "SCANNER", "PROXY_FETCHER", "API"
  details   String?  // JSON string for extra data
  createdAt DateTime @default(now())
}
