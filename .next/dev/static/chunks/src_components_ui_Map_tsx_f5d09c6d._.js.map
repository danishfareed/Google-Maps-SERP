{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/danish/codeplayground/GMBserp/src/components/ui/Map.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport {\n    MapContainer,\n    TileLayer,\n    CircleMarker,\n    Popup,\n    useMap,\n    ZoomControl,\n    useMapEvents,\n    Circle,\n    Marker\n} from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\n\n// Fix for default marker icon\n// @ts-ignore\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n    iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n});\n\ninterface Point {\n    lat: number;\n    lng: number;\n    rank: number | null;\n    hasData?: boolean;\n    id?: string;\n    draggable?: boolean;\n}\n\ninterface MapProps {\n    center: [number, number];\n    zoom: number;\n    points?: Point[];\n    onCenterChange?: (lat: number, lng: number) => void;\n    selectionMode?: boolean;\n    radius?: number; // In KM\n    gridSize?: number;\n    onPointClick?: (point: Point) => void;\n    onPointMove?: (pointId: string, lat: number, lng: number) => void;\n    onGridMove?: (lat: number, lng: number) => void;\n    showHeatmap?: boolean;\n}\n\nfunction MapUpdater({ center, zoom }: { center: [number, number]; zoom: number }) {\n    const map = useMap();\n    useEffect(() => {\n        map.setView(center, zoom);\n    }, [center, zoom, map]);\n    return null;\n}\n\nfunction SelectionHandler({ onCenterChange }: { onCenterChange?: (lat: number, lng: number) => void }) {\n    useMapEvents({\n        click(e) {\n            onCenterChange?.(e.latlng.lat, e.latlng.lng);\n        },\n    });\n    return null;\n}\n\nconst RankMarker = ({\n    point,\n    onClick,\n    onMove\n}: {\n    point: Point;\n    onClick?: (point: Point) => void;\n    onMove?: (pointId: string, lat: number, lng: number) => void;\n}) => {\n    let color = '#9ca3af'; // gray-400 (not found)\n    let fillColor = '#d1d5db'; // gray-300\n    let radius = 14;\n\n    if (point.rank !== null) {\n        if (point.rank <= 3) {\n            color = '#15803d'; // green-700\n            fillColor = '#22c55e'; // green-500\n            radius = 18;\n        } else if (point.rank <= 10) {\n            color = '#b45309'; // amber-700\n            fillColor = '#f59e0b'; // amber-500\n            radius = 16;\n        } else {\n            color = '#b91c1c'; // red-700\n            fillColor = '#ef4444'; // red-500\n        }\n    } else if (point.hasData) {\n        color = '#2563eb'; // blue-600\n        fillColor = '#60a5fa'; // blue-400\n        radius = 16;\n    }\n\n    if (point.draggable && onMove && point.id) {\n        return (\n            <Marker\n                position={[point.lat, point.lng]}\n                draggable={true}\n                eventHandlers={{\n                    dragend: (e) => {\n                        const marker = e.target;\n                        const position = marker.getLatLng();\n                        onMove(point.id!, position.lat, position.lng);\n                    },\n                }}\n            />\n        );\n    }\n\n    return (\n        <CircleMarker\n            center={[point.lat, point.lng]}\n            radius={radius}\n            eventHandlers={{\n                click: () => onClick?.(point),\n            }}\n            pathOptions={{\n                color: color,\n                weight: 2,\n                fillColor: fillColor,\n                fillOpacity: 1,\n            }}\n        >\n            {!onClick && (\n                <Popup className=\"font-sans\">\n                    <div className=\"text-center p-1\">\n                        <div className=\"font-bold text-lg mb-1 text-gray-900\">\n                            #{point.rank ?? '-'}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                            Lat: {point.lat.toFixed(4)}<br />\n                            Lng: {point.lng.toFixed(4)}\n                        </div>\n                    </div>\n                </Popup>\n            )}\n        </CircleMarker>\n    );\n};\n\nfunction MapResizer() {\n    const map = useMap();\n    useEffect(() => {\n        // Delay slightly to allow modal animations to finish\n        const timer = setTimeout(() => {\n            map.invalidateSize();\n        }, 100);\n        return () => clearTimeout(timer);\n    }, [map]);\n    return null;\n}\n\nexport default function LeafletMap({\n    center,\n    zoom,\n    points = [],\n    onCenterChange,\n    selectionMode = false,\n    radius = 5,\n    gridSize = 3,\n    onPointClick,\n    onPointMove,\n    onGridMove,\n    showHeatmap = false\n}: MapProps) {\n    return (\n        <div className=\"h-full w-full relative z-0 bg-gray-100\">\n            <MapContainer\n                center={center}\n                zoom={zoom}\n                style={{ height: '100%', width: '100%', filter: 'contrast(1.05) saturate(1.1)' }}\n                scrollWheelZoom={true}\n                zoomControl={false}\n            >\n                <ZoomControl position=\"bottomright\" />\n                <MapResizer />\n\n                <TileLayer\n                    attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n                    url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n                />\n                <MapUpdater center={center} zoom={zoom} />\n\n                {selectionMode && <SelectionHandler onCenterChange={onCenterChange} />}\n\n                {/* Selection Mode Visuals: Circle and Grid Preview */}\n                {(selectionMode || onGridMove) && (\n                    <>\n                        <Circle\n                            center={center}\n                            radius={radius * 1000}\n                            pathOptions={{ color: '#2563eb', fillColor: '#2563eb', fillOpacity: 0.1, weight: 1, dashArray: '5, 5' }}\n                        />\n                        <Marker\n                            position={center}\n                            draggable={Boolean(onGridMove)}\n                            eventHandlers={{\n                                dragend: (e) => {\n                                    const marker = e.target;\n                                    const position = marker.getLatLng();\n                                    onGridMove?.(position.lat, position.lng);\n                                    onCenterChange?.(position.lat, position.lng);\n                                },\n                            }}\n                        />\n                    </>\n                )}\n\n                {/* Heatmap Layer - Large gradient circles for ranking density */}\n                {showHeatmap && points.map((point, i) => {\n                    let heatColor = 'rgba(156, 163, 175, 0.3)'; // gray for unranked\n                    if (point.rank !== null) {\n                        if (point.rank <= 3) {\n                            heatColor = 'rgba(34, 197, 94, 0.35)'; // green\n                        } else if (point.rank <= 10) {\n                            heatColor = 'rgba(245, 158, 11, 0.35)'; // amber\n                        } else {\n                            heatColor = 'rgba(239, 68, 68, 0.35)'; // red\n                        }\n                    }\n                    return (\n                        <Circle\n                            key={`heat-${point.id || i}`}\n                            center={[point.lat, point.lng]}\n                            radius={800} // 800 meters\n                            pathOptions={{\n                                color: 'transparent',\n                                fillColor: heatColor,\n                                fillOpacity: 1,\n                            }}\n                        />\n                    );\n                })}\n\n                {/* Ranking Points */}\n                {points.map((point, i) => (\n                    <RankMarker\n                        key={point.id || i}\n                        point={point}\n                        onClick={onPointClick}\n                        onMove={onPointMove}\n                    />\n                ))}\n            </MapContainer>\n\n            {/* Floating Legend - Only in results mode */}\n            {!selectionMode && points.length > 0 && (\n                <div className=\"absolute top-4 right-4 bg-white/95 backdrop-blur border border-gray-200 p-3 rounded-lg shadow-lg z-[1000] text-xs font-medium space-y-2\">\n                    <div className=\"font-bold text-gray-900 mb-1 border-b border-gray-100 pb-1\">Rank Legend</div>\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"w-3 h-3 rounded-full bg-green-500 border border-green-700\"></div>\n                        <span className=\"text-gray-700\">1 - 3</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"w-3 h-3 rounded-full bg-amber-500 border border-amber-700\"></div>\n                        <span className=\"text-gray-700\">4 - 10</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"w-3 h-3 rounded-full bg-red-500 border border-red-700\"></div>\n                        <span className=\"text-gray-700\">11+</span>\n                    </div>\n                </div>\n            )}\n\n            {selectionMode && (\n                <div className=\"absolute top-4 left-4 bg-white/95 backdrop-blur border border-gray-200 p-3 rounded-lg shadow-lg z-[1000] text-xs font-medium\">\n                    <p className=\"text-blue-600 font-bold\">Interactive Mode</p>\n                    <p className=\"text-gray-500 mt-1\">Click map to set center location.</p>\n                    <p className=\"text-gray-400 text-[10px] mt-1\">Drag center marker to move grid.</p>\n                </div>\n            )}\n        </div>\n    );\n}\n\n"],"names":[],"mappings":"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"}}]
}